<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Market Simulator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #121212;
      color: white;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    header {
      padding: 10px;
      text-align: center;
      background-color: #1e1e1e;
    }
    .container {
      display: flex;
      flex: 1;
      overflow: hidden;
    }
    .sidebar {
      width: 200px;
      background: #1f1f1f;
      overflow-y: auto;
      padding: 10px;
    }
    .sidebar h3 {
      margin-top: 0;
    }
    .sidebar button {
      width: 100%;
      margin: 5px 0;
      background: #292929;
      border: none;
      padding: 8px;
      color: white;
      cursor: pointer;
    }
    .main {
      flex: 1;
      padding: 10px;
    }
    canvas {
      background: black;
      border-radius: 5px;
      width: 100%;
    }
    .controls {
      margin: 10px 0;
    }
    .controls select, .controls input {
      padding: 5px;
      margin-right: 10px;
    }
    .balance {
      font-weight: bold;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        display: flex;
        flex-wrap: wrap;
      }
      .sidebar button {
        flex: 1 1 45%;
        margin: 5px;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>Trading & Market Simulator</h1>
    <div class="balance">Balance: â‚¦<span id="balance">50000</span></div>
  </header>

  <div class="container">
    <div class="sidebar">
      <h3>Categories</h3>
      <button onclick="showAssets('crypto')">Crypto</button>
      <button onclick="showAssets('stocks')">Stocks</button>
      <button onclick="showAssets('commodities')">Commodities</button>
      <button onclick="showAssets('forex')">Forex</button>
      <div id="asset-list"></div>
    </div>

    <div class="main">
      <div class="controls">
        <label>Timeframe:
          <select id="timeframe" onchange="loadData()">
            <option value="1D">1D</option>
            <option value="1W">1W</option>
            <option value="1M" selected>1M</option>
            <option value="1Y">1Y</option>
          </select>
        </label>
        <label>Quantity:
          <input type="number" id="quantity" value="1" min="1" />
        </label>
        <button onclick="trade('buy')">Buy</button>
        <button onclick="trade('sell')">Sell</button>
      </div>
      <canvas id="chart"></canvas>
    </div>
  </div>

  <script>
    const API_KEY = "S0CBS8L9QUAVNI6W"; // Your Alpha Vantage API key
    const balanceEl = document.getElementById('balance');
    const ctx = document.getElementById('chart').getContext('2d');
    let balance = 50000;
    let chart, currentSymbol = 'AAPL', currentType = 'stocks';

    const assets = {
      crypto: ['BTCUSD', 'ETHUSD', 'BNBUSD'],
      stocks: ['AAPL', 'MSFT', 'TSLA'],
      commodities: ['XAUUSD', 'XAGUSD', 'WTI'],
      forex: ['EURUSD', 'USDJPY', 'GBPUSD']
    };

    function showAssets(category) {
      currentType = category;
      const container = document.getElementById('asset-list');
      container.innerHTML = '';
      assets[category].forEach(symbol => {
        const btn = document.createElement('button');
        btn.textContent = symbol;
        btn.onclick = () => {
          currentSymbol = symbol;
          loadData();
        };
        container.appendChild(btn);
      });
    }

    function getFunctionName(timeframe) {
      if (timeframe === '1D') return 'TIME_SERIES_INTRADAY&interval=60min';
      if (timeframe === '1W' || timeframe === '1M') return 'TIME_SERIES_DAILY_ADJUSTED';
      return 'TIME_SERIES_WEEKLY_ADJUSTED';
    }

    async function loadData() {
      const timeframe = document.getElementById('timeframe').value;
      const func = getFunctionName(timeframe);
      const url = `https://www.alphavantage.co/query?function=${func}&symbol=${currentSymbol}&apikey=${API_KEY}`;
      try {
        const res = await fetch(url);
        const data = await res.json();
        const key = Object.keys(data).find(k => k.includes('Time Series'));
        if (!key) throw new Error("Data not found");

        const series = Object.entries(data[key])
          .slice(0, 50)
          .reverse()
          .map(([date, d]) => ({
            x: new Date(date),
            o: +d['1. open'],
            h: +d['2. high'],
            l: +d['3. low'],
            c: +d['4. close']
          }));

        renderChart(series);
      } catch (err) {
        console.error('Error:', err.message);
      }
    }

    function renderChart(data) {
      if (chart) chart.destroy();

      const isMobile = window.innerWidth < 768;
      chart = new Chart(ctx, {
        type: isMobile ? 'line' : 'candlestick',
        data: {
          datasets: [{
            label: currentSymbol,
            data: isMobile
              ? data.map(d => ({ x: d.x, y: d.c }))
              : data
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            tooltip: { enabled: true }
          },
          scales: {
            x: {
              type: 'time',
              time: { unit: 'day' },
              ticks: { color: 'white' },
              grid: { color: '#444' }
            },
            y: {
              ticks: { color: 'white' },
              grid: { color: '#444' }
            }
          }
        }
      });
    }

    function trade(type) {
      const quantity = parseInt(document.getElementById('quantity').value);
      const price = chart.data.datasets[0].data.slice(-1)[0].c || chart.data.datasets[0].data.slice(-1)[0].y;
      const cost = quantity * price;
      if (type === 'buy' && cost <= balance) {
        balance -= cost;
      } else if (type === 'sell') {
        balance += cost;
      } else {
        alert('Insufficient balance!');
        return;
      }
      balanceEl.textContent = balance.toFixed(2);
    }

    showAssets('stocks');
    loadData();
  </script>
</body>
</html>
