<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trading Simulator</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #0d1117;
      color: #c9d1d9;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }
    #app {
      display: flex;
      flex: 1;
      flex-direction: row;
    }
    #sidebar {
      width: 200px;
      padding: 10px;
      background-color: #161b22;
      overflow-y: auto;
    }
    #sidebar h2 {
      margin-top: 0;
      font-size: 16px;
    }
    .category {
      margin-bottom: 20px;
    }
    .asset {
      cursor: pointer;
      margin: 5px 0;
      color: #58a6ff;
    }
    .asset:hover {
      text-decoration: underline;
    }
    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    #chart {
      flex: 1;
    }
    #profile {
      background-color: #161b22;
      padding: 10px;
      font-size: 14px;
    }
    select {
      background: #0d1117;
      color: #c9d1d9;
      border: 1px solid #30363d;
    }
  </style>
</head>
<body>
  <div id="app">
    <div id="sidebar">
      <h2>Forex</h2>
      <div class="asset" onclick="renderChart('USDNGN')">USD/NGN</div>
      <div class="asset" onclick="renderChart('EURUSD')">EUR/USD</div>
      <h2>Commodities</h2>
      <div class="asset" onclick="renderChart('XAUUSD')">Gold</div>
      <div class="asset" onclick="renderChart('XAGUSD')">Silver</div>
      <h2>Crypto</h2>
      <div class="asset" onclick="renderChart('BTCUSD')">Bitcoin</div>
      <div class="asset" onclick="renderChart('ETHUSD')">Ethereum</div>
      <h2>Stocks</h2>
      <div class="asset" onclick="renderChart('AAPL')">Apple</div>
      <div class="asset" onclick="renderChart('TSLA')">Tesla</div>
    </div>
    <div id="main">
      <div style="padding: 10px; background-color: #21262d;">
        Timeframe: 
        <select onchange="renderChart(currentSymbol, this.value)">
          <option value="1D">1 Day</option>
          <option value="1W">1 Week</option>
          <option value="1M" selected>1 Month</option>
          <option value="3M">3 Months</option>
          <option value="6M">6 Months</option>
          <option value="1Y">1 Year</option>
          <option value="5Y">5 Years</option>
        </select>
      </div>
      <div id="chart"></div>
      <div id="profile">
        Balance: â‚¦<span id="balance">50000</span>
      </div>
    </div>
  </div>

  <script>
    let currentSymbol = 'AAPL';
    let balance = 50000;
    const API_KEY = 'S0CBS8L9QUAVNI6W'; // Your Alpha Vantage key

    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
      layout: {
        background: { color: '#0d1117' },
        textColor: '#c9d1d9'
      },
      grid: {
        vertLines: { color: '#30363d' },
        horzLines: { color: '#30363d' }
      },
      timeScale: {
        timeVisible: true,
        secondsVisible: false
      },
    });

    const candleSeries = chart.addCandlestickSeries();

    async function fetchData(symbol, timeframe = '1M') {
      const intervalMap = {
        '1D': '60min',
        '1W': '60min',
        '1M': 'DAILY',
        '3M': 'DAILY',
        '6M': 'DAILY',
        '1Y': 'WEEKLY',
        '5Y': 'MONTHLY'
      };
      const func = intervalMap[timeframe] === '60min' ? 'TIME_SERIES_INTRADAY' : `TIME_SERIES_${intervalMap[timeframe]}`;
      const interval = intervalMap[timeframe] === '60min' ? '&interval=60min' : '';

      const url = `https://www.alphavantage.co/query?function=${func}&symbol=${symbol}&apikey=${API_KEY}${interval}`;

      try {
        const res = await fetch(url);
        const json = await res.json();
        const key = Object.keys(json).find(k => k.includes('Time Series'));
        if (!key || !json[key]) throw new Error(json['Note'] || 'No data');

        const data = json[key];
        return Object.entries(data).slice(0, 100).reverse().map(([time, d]) => ({
          time: Math.floor(new Date(time).getTime() / 1000),
          open: +d['1. open'],
          high: +d['2. high'],
          low: +d['3. low'],
          close: +d['4. close']
        }));
      } catch (err) {
        console.error('API error:', err.message);
        return [];
      }
    }

    async function renderChart(symbol = 'AAPL', timeframe = '1M') {
      currentSymbol = symbol;
      const data = await fetchData(symbol, timeframe);
      if (!data.length) {
        alert('No data available');
        return;
      }
      candleSeries.setData(data);
    }

    renderChart();
  </script>
</body>
</html>
