<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SimuTrade - Learn to Trade</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 0;
    }
    header {
      background: #1a202c;
      color: white;
      padding: 1em;
      text-align: center;
    }
    .container {
      display: flex;
      padding: 20px;
    }
    .chart, .trade-panel, .portfolio {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin: 10px;
      flex: 1;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    canvas {
      width: 100%;
      height: 200px;
    }
    select, input, button {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    .profit {
      color: green;
    }
    .loss {
      color: red;
    }
  </style>
</head>
<body>
  <header>
    <h1>SimuTrade</h1>
    <p>Learn to Trade Like a Pro</p>
  </header>

  <div class="container">
    <div class="chart">
      <h3>Stock Chart</h3>
      <select id="stock-select">
        <option value="AAPL">AAPL</option>
        <option value="GOOG">GOOG</option>
        <option value="TSLA">TSLA</option>
        <option value="AMZN">AMZN</option>
      </select>
      <canvas id="chart-canvas"></canvas>
    </div>

    <div class="trade-panel">
      <h3>Place a Trade</h3>
      <label>Stock:</label>
      <select id="trade-stock">
        <option value="AAPL">AAPL</option>
        <option value="GOOG">GOOG</option>
        <option value="TSLA">TSLA</option>
        <option value="AMZN">AMZN</option>
      </select>
      <label>Quantity:</label>
      <input type="number" id="quantity" value="1" min="1" />
      <button onclick="buyStock()">Buy</button>
      <button onclick="sellStock()">Sell</button>
    </div>

    <div class="portfolio">
      <h3>Your Portfolio</h3>
      <table>
        <thead>
          <tr>
            <th>Stock</th>
            <th>Quantity</th>
            <th>Avg Price</th>
            <th>Current Price</th>
            <th>P/L</th>
          </tr>
        </thead>
        <tbody id="portfolio-body"></tbody>
      </table>
    </div>
  </div>

  <script>
    const stocks = {
      AAPL: 150,
      GOOG: 2700,
      TSLA: 700,
      AMZN: 3300
    };

    let prices = {...stocks};

    const chartCanvas = document.getElementById("chart-canvas");
    const ctx = chartCanvas.getContext("2d");

    let chartData = Array(30).fill(0).map(() => Math.random() * 100 + 100);

    function drawChart(stock) {
      ctx.clearRect(0, 0, chartCanvas.width, chartCanvas.height);
      ctx.beginPath();
      chartData.forEach((price, index) => {
        const x = index * (chartCanvas.width / chartData.length);
        const y = chartCanvas.height - price;
        if (index === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.strokeStyle = "#4a90e2";
      ctx.stroke();
    }

    function updatePrices() {
      for (let stock in prices) {
        const change = (Math.random() - 0.5) * 10;
        prices[stock] = Math.max(1, prices[stock] + change);
      }
      drawChart(document.getElementById("stock-select").value);
      updatePortfolio();
    }

    function getPortfolio() {
      return JSON.parse(localStorage.getItem("portfolio") || "{}");
    }

    function savePortfolio(p) {
      localStorage.setItem("portfolio", JSON.stringify(p));
    }

    function buyStock() {
      const stock = document.getElementById("trade-stock").value;
      const qty = parseInt(document.getElementById("quantity").value);
      const price = prices[stock];
      let portfolio = getPortfolio();

      if (!portfolio[stock]) {
        portfolio[stock] = { qty: 0, avg: 0 };
      }

      const current = portfolio[stock];
      const totalCost = current.avg * current.qty + price * qty;
      const totalQty = current.qty + qty;
      current.avg = totalCost / totalQty;
      current.qty = totalQty;
      savePortfolio(portfolio);
      updatePortfolio();
    }

    function sellStock() {
      const stock = document.getElementById("trade-stock").value;
      const qty = parseInt(document.getElementById("quantity").value);
      const price = prices[stock];
      let portfolio = getPortfolio();

      if (!portfolio[stock] || portfolio[stock].qty < qty) {
        alert("You don't own enough shares!");
        return;
      }

      portfolio[stock].qty -= qty;
      if (portfolio[stock].qty === 0) {
        delete portfolio[stock];
      }
      savePortfolio(portfolio);
      updatePortfolio();
    }

    function updatePortfolio() {
      const tbody = document.getElementById("portfolio-body");
      tbody.innerHTML = "";
      const portfolio = getPortfolio();

      for (let stock in portfolio) {
        const { qty, avg } = portfolio[stock];
        const current = prices[stock];
        const pl = (current - avg) * qty;
        const row = `<tr>
          <td>${stock}</td>
          <td>${qty}</td>
          <td>$${avg.toFixed(2)}</td>
          <td>$${current.toFixed(2)}</td>
          <td class="${pl >= 0 ? "profit" : "loss"}">$${pl.toFixed(2)}</td>
        </tr>`;
        tbody.innerHTML += row;
      }
    }

    // Auto-update
    setInterval(updatePrices, 3000);

    document.getElementById("stock-select").addEventListener("change", function() {
      drawChart(this.value);
    });

    drawChart("AAPL");
    updatePortfolio();
  </script>
</body>
</html>
