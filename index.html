<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Trading Simulation Platform</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* --- Reset and base styles --- */
    body, html {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #eee;
      display: flex;
      overflow: hidden;
    }
    /* Sidebar */
    #sidebar {
      width: 240px;
      background: #222;
      padding: 15px;
      box-sizing: border-box;
      overflow-y: auto;
      border-right: 1px solid #333;
    }
    h3 {
      margin-top: 0;
      margin-bottom: 15px;
      color: #0ff;
      text-align: center;
    }
    .category {
      margin-bottom: 18px;
    }
    .category-btn {
      width: 100%;
      background-color: #333;
      color: #0ff;
      border: none;
      padding: 12px 15px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
      text-align: left;
      user-select: none;
      transition: background 0.3s;
    }
    .category-btn:hover {
      background-color: #0ff;
      color: #121212;
    }
    .assets-list {
      margin-top: 8px;
      display: none;
      padding-left: 10px;
    }
    .assets-list button {
      display: block;
      width: 100%;
      background-color: #444;
      border: none;
      color: #ddd;
      padding: 8px 10px;
      margin-top: 6px;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 14px;
    }
    .assets-list button:hover {
      background-color: #0ff;
      color: #121212;
    }

    /* Main content */
    #main {
      flex-grow: 1;
      padding: 25px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      background-color: #121212;
    }
    #balance {
      font-size: 20px;
      font-weight: bold;
      color: #0ff;
      margin-bottom: 12px;
      user-select: none;
    }
    #chartContainer {
      flex-grow: 1;
      position: relative;
    }
    canvas {
      width: 100% !important;
      height: 100% !important;
      max-height: 500px;
      user-select: none;
    }

    /* Scrollbar styling for sidebar */
    #sidebar::-webkit-scrollbar {
      width: 8px;
    }
    #sidebar::-webkit-scrollbar-thumb {
      background: #0ff;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h3>Assets</h3>

    <div class="category">
      <button class="category-btn" onclick="toggleCategory('forex')">Forex</button>
      <div class="assets-list" id="forex">
        <button onclick="renderChart('EUR/USD', 'forex')">EUR/USD</button>
        <button onclick="renderChart('USD/JPY', 'forex')">USD/JPY</button>
      </div>
    </div>

    <div class="category">
      <button class="category-btn" onclick="toggleCategory('commodities')">Commodities</button>
      <div class="assets-list" id="commodities">
        <button onclick="renderChart('XAUUSD', 'commodities')">Gold (XAUUSD)</button>
        <button onclick="renderChart('WTI', 'commodities')">Oil (WTI)</button>
      </div>
    </div>

    <div class="category">
      <button class="category-btn" onclick="toggleCategory('crypto')">Crypto</button>
      <div class="assets-list" id="crypto">
        <button onclick="renderChart('BTC', 'crypto')">Bitcoin (BTC)</button>
        <button onclick="renderChart('ETH', 'crypto')">Ethereum (ETH)</button>
      </div>
    </div>

    <div class="category">
      <button class="category-btn" onclick="toggleCategory('stocks')">Stocks</button>
      <div class="assets-list" id="stocks">
        <button onclick="renderChart('AAPL', 'stocks')">Apple (AAPL)</button>
        <button onclick="renderChart('TSLA', 'stocks')">Tesla (TSLA)</button>
      </div>
    </div>
  </div>

  <div id="main">
    <div id="balance">Balance: â‚¦50,000</div>
    <div id="chartContainer">
      <canvas id="chartCanvas"></canvas>
    </div>
  </div>

  <script>
    const ctx = document.getElementById('chartCanvas').getContext('2d');
    let chart = null;

    // Toggle asset category list
    function toggleCategory(id) {
      const el = document.getElementById(id);
      el.style.display = (el.style.display === 'block') ? 'none' : 'block';
    }

    // Render chart for selected asset
    async function renderChart(symbol, assetClass) {
      const apiKey = 'YOUR_API_KEY'; // <-- Replace with your Alpha Vantage API key

      let url = '';
      let timeSeriesKey = '';
      let market = 'USD';

      if (assetClass === 'forex') {
        // Forex API
        const [fromSymbol, toSymbol] = symbol.split('/');
        url = `https://www.alphavantage.co/query?function=FX_DAILY&from_symbol=${fromSymbol}&to_symbol=${toSymbol}&apikey=${apiKey}`;
        timeSeriesKey = 'Time Series FX (Daily)';
      } else if (assetClass === 'crypto') {
        url = `https://www.alphavantage.co/query?function=DIGITAL_CURRENCY_DAILY&symbol=${symbol}&market=${market}&apikey=${apiKey}`;
        timeSeriesKey = 'Time Series (Digital Currency Daily)';
      } else {
        // Stocks and Commodities share TIME_SERIES_DAILY (Note: commodities may need other APIs)
        url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&apikey=${apiKey}`;
        timeSeriesKey = 'Time Series (Daily)';
      }

      try {
        const res = await fetch(url);
        const data = await res.json();

        const timeSeries = data[timeSeriesKey];

        if (!timeSeries) {
          alert('Data unavailable or API call limit reached. Try again later.');
          return;
        }

        const labels = [];
        const prices = [];

        for (const date in timeSeries) {
          labels.unshift(date);
          if (assetClass === 'crypto') {
            prices.unshift(parseFloat(timeSeries[date]['4a. close (USD)']));
          } else {
            prices.unshift(parseFloat(timeSeries[date]['4. close']));
          }
        }

        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels.slice(-30), // last 30 days
            datasets: [{
              label: `${symbol} Price`,
              data: prices.slice(-30),
              borderColor: '#0ff',
              backgroundColor: 'rgba(0, 255, 255, 0.2)',
              borderWidth: 2,
              pointRadius: 2,
              fill: true,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                ticks: { color: '#aaa' },
                grid: { color: '#333' }
              },
              y: {
                ticks: { color: '#aaa' },
                grid: { color: '#333' },
                beginAtZero: false
              }
            },
            plugins: {
              legend: {
                labels: { color: '#0ff' }
              },
              tooltip: {
                mode: 'index',
                intersect: false,
              }
            },
            interaction: {
              mode: 'nearest',
              intersect: false
            }
          }
        });

      } catch (error) {
        alert('Failed to fetch or render data. Check console for errors.');
        console.error(error);
      }
    }
  </script>
</body>
</html>
