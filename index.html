<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Trading Simulator with Time</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #0e1117;
      color: #eee;
      margin: 0;
      padding: 0;
    }
    header {
      background-color: #111;
      padding: 15px;
      text-align: center;
      font-size: 24px;
      color: #0f0;
      border-bottom: 2px solid #222;
    }
    #content {
      display: flex;
      flex-direction: row;
      height: 100vh;
    }
    #market {
      flex: 2;
      padding: 20px;
    }
    #portfolio {
      flex: 1;
      background-color: #1a1d23;
      padding: 20px;
      border-left: 2px solid #222;
    }
    .asset {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
    }
    button {
      background-color: #08f;
      color: white;
      border: none;
      padding: 4px 8px;
      cursor: pointer;
      margin-left: 5px;
    }
    button:hover {
      background-color: #05c;
    }
    canvas {
      background-color: #fff;
      border: 2px solid #444;
      margin-top: 20px;
      width: 100%;
    }
  </style>
</head>
<body>
  <header>Trading Simulator with Time</header>
  <div id="content">
    <div id="market">
      <h2>Market</h2>
      <div id="assets"></div>
      <canvas id="chart" width="800" height="300"></canvas>
    </div>
    <div id="portfolio">
      <h2>Portfolio</h2>
      <p>Balance: $<span id="balance">10000</span></p>
      <div id="holdings"></div>
    </div>
  </div>

  <script>
    const assets = [
      { name: 'Gold', type: 'Commodity', price: 1950 },
      { name: 'Crude Oil', type: 'Commodity', price: 85 },
      { name: 'EUR/USD', type: 'Forex', price: 1.1 },
      { name: 'USD/JPY', type: 'Forex', price: 145 },
      { name: 'AAPL', type: 'Stock', price: 180 },
      { name: 'TSLA', type: 'Stock', price: 220 },
      { name: 'Bitcoin Futures', type: 'Derivative', price: 65000 },
      { name: 'VIX Option', type: 'Derivative', price: 17 }
    ];
    let balance = 10000;
    const holdings = {};
    const priceHistory = {};
    const timeHistory = {};
    const chart = document.getElementById('chart');
    const ctx = chart.getContext('2d');
    let selectedAsset = assets[0].name;

    let timeMinutes = 0;

    function getSimulatedTime() {
      const day = Math.floor(timeMinutes / (24 * 60)) + 1;
      const minutesInDay = timeMinutes % (24 * 60);
      const hour = Math.floor(minutesInDay / 60);
      const minute = minutesInDay % 60;
      const ampm = hour >= 12 ? 'PM' : 'AM';
      const hour12 = hour % 12 === 0 ? 12 : hour % 12;
      const minStr = minute < 10 ? '0' + minute : minute;
      return { label: `Day ${day} ${hour12}:${minStr} ${ampm}`, short: `${hour12}:${minStr}` };
    }

    function randomVolatility(basePrice) {
      const volatility = 0.005 + Math.random() * 0.015;
      return basePrice * (1 + (Math.random() - 0.5) * volatility * 10);
    }

    function renderAssets() {
      const container = document.getElementById('assets');
      container.innerHTML = '';
      assets.forEach(asset => {
        if (!priceHistory[asset.name]) {
          priceHistory[asset.name] = [asset.price];
          timeHistory[asset.name] = [getSimulatedTime().label];
        }
        const div = document.createElement('div');
        div.className = 'asset';
        div.innerHTML = `
          <span>${asset.name} (${asset.type}): $${asset.price.toFixed(2)}</span>
          <span>
            <button onclick="buy('${asset.name}')">Buy</button>
            <button onclick="sell('${asset.name}')">Sell</button>
            <button onclick="select('${asset.name}')">Chart</button>
          </span>
        `;
        container.appendChild(div);
      });
    }

    function renderPortfolio() {
      document.getElementById('balance').textContent = balance.toFixed(2);
      const holdingsDiv = document.getElementById('holdings');
      holdingsDiv.innerHTML = '';
      for (const asset in holdings) {
        const amt = holdings[asset];
        const price = assets.find(a => a.name === asset).price;
        const val = amt * price;
        holdingsDiv.innerHTML += `<p>${asset}: ${amt} units ($${val.toFixed(2)})</p>`;
      }
    }

    function buy(assetName) {
      const asset = assets.find(a => a.name === assetName);
      const cost = asset.price;
      if (balance >= cost) {
        balance -= cost;
        holdings[assetName] = (holdings[assetName] || 0) + 1;
        renderPortfolio();
      }
    }

    function sell(assetName) {
      if (holdings[assetName] > 0) {
        const asset = assets.find(a => a.name === assetName);
        balance += asset.price;
        holdings[assetName]--;
        renderPortfolio();
      }
    }

    function select(name) {
      selectedAsset = name;
      drawChart();
    }

    function updatePrices() {
      timeMinutes++;
      const simTime = getSimulatedTime();

      assets.forEach(asset => {
        const newPrice = randomVolatility(asset.price);
        asset.price = newPrice;
        priceHistory[asset.name].push(newPrice);
        timeHistory[asset.name].push(simTime.label);
        if (priceHistory[asset.name].length > 100) {
          priceHistory[asset.name].shift();
          timeHistory[asset.name].shift();
        }
      });

      renderAssets();
      drawChart();
    }

    function drawChart() {
      ctx.clearRect(0, 0, chart.width, chart.height);
      const prices = priceHistory[selectedAsset];
      const times = timeHistory[selectedAsset];
      if (!prices) return;

      const max = Math.max(...prices);
      const min = Math.min(...prices);
      const range = max - min || 1;

      ctx.strokeStyle = 'green';
      ctx.beginPath();
      prices.forEach((p, i) => {
        const x = (i / prices.length) * chart.width;
        const y = chart.height - ((p - min) / range) * chart.height;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      ctx.fillStyle = '#000';
      ctx.font = '14px monospace';
      ctx.fillText(selectedAsset + " | $" + prices[prices.length - 1].toFixed(2), 10, 20);
      ctx.fillText("Time: " + times[times.length - 1], 10, 40);
    }

    setInterval(updatePrices, 1000);
    renderAssets();
    renderPortfolio();
    drawChart();
  </script>
</body>
</html>
