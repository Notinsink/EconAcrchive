<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Trading Simulator</title>
  <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.0.1/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: Arial, sans-serif; background: #111; color: #fff; display: flex; height: 100vh; }

    .sidebar {
      width: 200px;
      background: #1a1a1a;
      padding: 1rem;
      overflow-y: auto;
    }

    .category {
      margin-bottom: 1rem;
    }

    .category h3 {
      cursor: pointer;
      color: #00ffcc;
      margin-bottom: 0.5rem;
    }

    .asset-list {
      display: none;
      padding-left: 1rem;
    }

    .asset {
      cursor: pointer;
      margin: 0.3rem 0;
      color: #ccc;
    }

    .asset:hover {
      color: #fff;
    }

    .main {
      flex: 1;
      padding: 1rem;
      display: flex;
      flex-direction: column;
    }

    #chart {
      flex: 1;
      border: 1px solid #333;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
    }

    .balance {
      font-weight: bold;
    }

    .timeframes button {
      margin: 0 0.2rem;
      background: #333;
      border: none;
      padding: 0.4rem 0.6rem;
      color: #fff;
      cursor: pointer;
    }

    .timeframes button:hover {
      background: #555;
    }

    @media(max-width: 768px) {
      .sidebar { width: 100px; }
      .main { padding: 0.5rem; }
      .top-bar { flex-direction: column; }
    }
  </style>
</head>
<body>
  <div class="sidebar">
    <div class="category">
      <h3 onclick="toggleList('crypto')">Crypto</h3>
      <div class="asset-list" id="crypto">
        <div class="asset" onclick="renderChart('BTCUSD')">Bitcoin</div>
        <div class="asset" onclick="renderChart('ETHUSD')">Ethereum</div>
      </div>
    </div>
    <div class="category">
      <h3 onclick="toggleList('stocks')">Stocks</h3>
      <div class="asset-list" id="stocks">
        <div class="asset" onclick="renderChart('AAPL')">Apple</div>
        <div class="asset" onclick="renderChart('TSLA')">Tesla</div>
      </div>
    </div>
    <div class="category">
      <h3 onclick="toggleList('commodities')">Commodities</h3>
      <div class="asset-list" id="commodities">
        <div class="asset" onclick="renderChart('XAUUSD')">Gold</div>
        <div class="asset" onclick="renderChart('XAGUSD')">Silver</div>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="top-bar">
      <div class="balance">Balance: â‚¦<span id="balance">50000</span></div>
      <div class="timeframes">
        <button onclick="renderChart(currentSymbol, '1D')">1D</button>
        <button onclick="renderChart(currentSymbol, '1W')">1W</button>
        <button onclick="renderChart(currentSymbol, '1M')">1M</button>
        <button onclick="renderChart(currentSymbol, '3M')">3M</button>
        <button onclick="renderChart(currentSymbol, '1Y')">1Y</button>
      </div>
    </div>
    <div id="chart"></div>
  </div>

  <script>
    let chart, series;
    const isMobile = window.innerWidth <= 768;
    const API_KEY = 'S0CBS8L9QUAVNI6W';
    let currentSymbol = 'BTCUSD';

    function toggleList(id) {
      const list = document.getElementById(id);
      list.style.display = list.style.display === 'block' ? 'none' : 'block';
    }

    function initChart() {
      if (chart) chart.remove();
      chart = LightweightCharts.createChart(document.getElementById('chart'), {
        width: document.getElementById('chart').clientWidth,
        height: 500,
        layout: { backgroundColor: '#000', textColor: '#fff' },
        grid: { vertLines: { color: '#222' }, horzLines: { color: '#222' } },
        crosshair: { mode: 1 },
        timeScale: { timeVisible: true, secondsVisible: false }
      });
      series = isMobile ? chart.addLineSeries() : chart.addCandlestickSeries();
    }

    async function fetchData(symbol, interval = '1M') {
      const intervalMap = {
        '1D': { func: 'TIME_SERIES_INTRADAY', interval: '60min' },
        '1W': { func: 'TIME_SERIES_DAILY' },
        '1M': { func: 'TIME_SERIES_DAILY' },
        '3M': { func: 'TIME_SERIES_DAILY' },
        '1Y': { func: 'TIME_SERIES_WEEKLY' }
      };

      const { func, interval: intv = 'daily' } = intervalMap[interval] || intervalMap['1M'];
      const url = `https://www.alphavantage.co/query?function=${func}&symbol=${symbol}&interval=${intv}&apikey=${API_KEY}`;
      
      try {
        const res = await fetch(url);
        const json = await res.json();
        const key = Object.keys(json).find(k => k.includes('Time Series'));
        const data = json[key];
        return Object.entries(data).slice(0, 100).reverse().map(([date, val]) => ({
          time: Math.floor(new Date(date).getTime() / 1000),
          open: +val['1. open'],
          high: +val['2. high'],
          low: +val['3. low'],
          close: +val['4. close'],
          value: +val['4. close']
        }));
      } catch (err) {
        alert('Error loading chart data');
        return [];
      }
    }

    async function renderChart(symbol = 'BTCUSD', interval = '1M') {
      currentSymbol = symbol;
      initChart();
      const data = await fetchData(symbol, interval);
      if (isMobile) {
        series.setData(data.map(p => ({ time: p.time, value: p.close })));
      } else {
        series.setData(data);
      }
    }

    renderChart();
  </script>
</body>
</html>
